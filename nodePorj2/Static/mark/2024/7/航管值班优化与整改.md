# 航管值班优化与整改

首先对计划列表进行修改。

### 0.航管计划流程重解

1. 顶部菜单
2. 进程单查找（历史进程单）
   进程单里的机场名称，制单日期，进程单号，进程类型（下拉）都是可缺省的。弹框可以查询，点击进程单选项，点击下方的打开按钮，要弹出<u>**预览弹框**</u>。点击取消就关闭。
3. 飞行计划查找（历史分析计划）
   用于查找历史飞行计划，其中，所属飞机机型和飞机编号都是下拉框？，所有搜索项都是可缺少的，同样，飞行计划有预览弹框，显示涉及的空域列表和航电列表
4. 机场查找（略）
5. 状态栏（略）
6. 计划消息接受，接受到下发的计划后，消息弹框要能打开对应的飞行计划？
7. 点击“打开”（？）后，显示当前的计划窗口，在这个窗口可以打开对应计划。
8. 计划区列表
   一个树结构的任务栏，一级目录是任务计划，二级是机型+编号（每个任务下可以包含多个无人机）,三级目录是：飞行计划名称，包含一个状态的参数；离场进程名；进程进程名，进程都包含状态（未处理，处理中，已经处理）
   计划区有右键菜单，
   第一级是右键-打开任务计划，当选中的任务计划是打开状态时候，要加一个关闭任务计划（用于关闭当前任务计划），而打开任务计划与搜索任务计划相似；
   第二级是右键-获取飞行计划，添加进程，点击获取飞行计划，会自动生成名为飞行计划的飞行计划，状态为未上报。点击飞行计划的名字的时候，有删除飞行计划和标记为上报的菜单；
   第三级是右键-添加进程，删除进程
9. 进程单管理界面
    进程单管理分为编辑和预览2部分
10. 飞机计划编辑界面
    用于编辑当前飞行计划，其中机型，飞机编号，二次代码，起降机场，飞行高度限制，涉及空域表航点表均来自任务规划中该架次飞机的计划。
    飞行计划高度上下限用航点最大值最小值获取，实际起飞时间和起降机场根据对应进程单编写。
    编辑和的飞行计划通过电话上报并协调空域？
11. 机场基本信息（略）
12. 航管值班席正常使用流程
    1. 按照站内统一的任务计划，飞行监控席会告知全站将飞行器推出。此时航管值班员在对应架次下生成离场进程单。
    2. 航管值班员再查看当前跑道的使用情况，与地勤人员确认后，通知飞行监控席位可以使用此跑到
    3. 此时在进程编辑里填写必要的进程信息等等
    4. 等飞行设备进入跑到后，需要记录飞行器的爬升程序，记录飞行器的飞行情况，比如6000m爬升一次，9000m爬升一次这样
    5. 最终飞行设备降落，形成最后的离场进程单，此时可以打印进程单备案或是上报到指挥协调席
    进场管理与离场管理程序相似，只是记录飞行记录变成记录进场的飞行记录。具体内容不再赘述。

### 1.计划列表

首先对计划列表数据的传入与更新进行规划（不要之前通过全局变量控制）

1.如果需要更新某一个组件的数据，那么最好在外部做好这个组件的更新函数，那么就可以在其他的组件调用这个更新函数，在其他组件里也可以更新对应组件的数据了。

树节点的左击事件，需要对当前显示的数据进行更新；
最好能区分左击或者右击事件；

然后对计划列表的右键方式进行处理，右键的时候，会根据不同的类型生成不同的菜单；
每个菜单项对应不同的弹框，每个弹框可能需要不同的数据；

2.根据event的button的属性区分开左击还是右击事件，左击是设置数据，右击是打开下拉菜单；
3.根据点击的树节点类型，设置对应数据或是下拉菜单；

整理一下现在已有的类型和对应类型需要的操作：
- 一级节点 根节点 显示任务名称 rootplan （只有一个）
- 二级节点 显示机型名称 airplay （只有一个）
- 三级节点
  有飞行计划 airplayplan (这里需要大改）
  离场进程 leaveprocess
  进程进程 pushprocess
- 四级节点 设备进程单 leaveprocessitem or pushprocessitem

然后现在重新设置一下左键点击的逻辑（老的太繁杂了）
右键事件只打开下拉框，不做其他操作；
左键事件只进行选中节点的赋值，和当前选择状态的设置。

先解决好计划列表的弹框操作吧，把挂载在全局的弹框改成局部弹框了，原来的太臃肿。

### 2.数据关联

完成了chose type 设置后，需要将状态和其他起降编辑，飞行计划这两个组件进行联动（搁置）

暂时搞定菜单栏的弹框处理；现在处理计划列表和场降管理的联动；
基础的数据联动完成，处理预览单的问题，关于pb这些数据梳理一下：

- pb指的是推出的编码
- st指的是开车或离场的编码
- tax指的是滑行编码
- rw指的是从哪条跑道起飞的编码
- 在进程单制单日期下的编码是值停机坪的编码
- 接口对应字段数据
  - drive 开车 st
  - park 停机 
  - slider 滑行 tax
  - unveil 推出 pb
  - enter 进跑道 rw

ok 搞定

### 3.本场机场设置

进入航管值班席位的时候检测是否有本场机场信息，没有就主动弹出弹框，有就不管

### 4.限制逻辑

现在做本次机场设置，处理一下航管操作逻辑细节：
- 计划列表的获取
  目前计划列表的获取取决于该飞行计划是否是打开状态，开关状态交由历史飞行计划控制（历史飞行计划可以打开历史关闭的飞行计划）
- 飞行计划机场编辑
  飞行计划是可以修改任意机场的，根据修改的机场名称来决定，是否可以生成进程单

### 5.飞行计划编辑

  首先搞定飞行计划编辑的数据关联。

### 6.进程单预检

  新建进程单的时候，需要根据飞行计划内的数据进行检测。
  离场检测起飞机场，进场检测降落机场

  起飞时间检测

### 7.进程编辑的高度操作

11